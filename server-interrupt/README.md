# Agora Agent Starter Script (Interrupt Features)

[中文](README-CN.md) | English

Command-line script collection for starting and stopping Agora Conversational AI Agent (Interrupt Features version). This directory contains two scripts supporting **Keyword Interrupt** and **Graceful Interrupt (AIVAD)** features.

## Script Description

- **`agent_interrupt_keyword.py`** - Keyword interrupt script
- **`agent_interrupt_aivad.py`** - Graceful interrupt (AIVAD) script

**Important Note**: Keyword interrupt and graceful interrupt (AIVAD) features are mutually exclusive and cannot be enabled simultaneously.

## Prerequisites

- Python 3.6 or higher
- Agora developer account [Console](https://console.shengwang.cn/)
- Created Agora project and obtained App ID, Basic Auth credentials, Pipeline ID

## Install Dependencies

```bash
cd server-interrupt

# Create virtual environment
python3 -m venv venv

# Activate virtual environment
# Linux/macOS: source venv/bin/activate
# Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt
```

## Configuration

1. Copy example configuration file:
```bash
cp .env.example .env.local
```

2. Edit `.env.local` file and fill in configuration values:

```bash
AGORA_APP_ID=your_app_id_here
AGORA_APP_CERT=your_app_certificate_here  # Optional
AGORA_BASIC_KEY=your_basic_key_here
AGORA_BASIC_SECRET=your_basic_secret_here
AGORA_PIPELINE_ID=your_pipeline_id_here
AGORA_CHANNEL_NAME=your_channel_name_here

# Only required for keyword interrupt script
AGORA_INTERRUPT_KEYWORDS=stop,pause,end,stop talking
```

## Pipeline Configuration

When creating a Pipeline in [AI Studio](https://console-conversationai.shengwang.cn/product/ConversationAI/studio), you **do not need** to enable interrupt features in the Pipeline configuration. Interrupt features are enabled via RESTful API request parameters when starting the Agent, and the scripts will automatically add the corresponding parameters.

## Usage

### Start Agent

**Keyword Interrupt:**
```bash
python agent_interrupt_keyword.py start
```

**Graceful Interrupt (AIVAD):**
```bash
python agent_interrupt_aivad.py start
```

Script startup process:
1. Generate Agent Token (Agent RTC UID fixed value: `1009527`)
2. Send RESTful request to start Agent, automatically add interrupt feature configuration
3. Save Agent ID to `.agent_id` file

**Request Body Differences:**

Keyword Interrupt:
```json
{
  "properties": {
    "turn_detection": {
      "interrupt_mode": "keywords",
      "interrupt_keywords": ["stop", "pause", "end"]
    }
  }
}
```

Graceful Interrupt (AIVAD):
```json
{
  "properties": {
    "advanced_features": {
      "enable_aivad": true
    }
  }
}
```

**Note**: When using AIVAD, the default value of `turn_detection.interrupt_mode` is `"interrupt"` (interrupt mode).

### Stop Agent

```bash
# Keyword Interrupt
python agent_interrupt_keyword.py stop

# Graceful Interrupt (AIVAD)
python agent_interrupt_aivad.py stop
```

Optional parameter: `--agent-id` (if not provided, uses the Agent ID from the last successful start)

## Feature Description

### Keyword Interrupt

- **Feature**: Interrupts the agent when the user speaks preset keywords
- **Configuration**: Set keywords via `AGORA_INTERRUPT_KEYWORDS` (comma-separated, max 128)
- **Limitations**: Mutually exclusive with AIVAD; keyword recognition capability depends on ASR provider

### Graceful Interrupt (AIVAD)

- **Feature**: AI Voice Activity Detection, intelligently detects and handles voice activity
- **Configuration**: No additional configuration needed, script automatically enables it
- **Limitations**: Mutually exclusive with keyword interrupt; uses `interrupt` mode by default

## Technical Parameters

- `agent_rtc_uid` fixed value: `1009527`
- Agent Token is automatically generated by the server

## Related Documentation

- [Create Conversational Agent API Documentation](https://doc.shengwang.cn/doc/convoai/restful/convoai/operations/start-agent)
- [AI Studio Console](https://console-conversationai.shengwang.cn/product/ConversationAI/studio)

## View Results

After starting the Agent, you can use the Web application to view results. Please refer to [web-react-lite/README.md](../web-react-lite/README.md).

**Note**: The channel name used in the Web application must match `AGORA_CHANNEL_NAME` in `.env.local`.
